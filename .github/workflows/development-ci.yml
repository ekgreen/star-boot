# ðŸ› ï¸ Development CI - Ð‘Ñ‹ÑÑ‚Ñ€Ð°Ñ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ dev Ð²ÐµÑ‚Ð¾Ðº
#
# Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð´Ð»Ñ development Ð²ÐµÑ‚Ð¾Ðº:
# - Ð‘Ñ‹ÑÑ‚Ñ€Ð°Ñ ÐºÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ñ Ð´Ð»Ñ Ñ€Ð°Ð½Ð½ÐµÐ³Ð¾ Ð¾Ð±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼
# - Ð‘ÐµÐ· Ð¿Ð¾Ð»Ð½Ð¾Ð³Ð¾ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ (ÑÐºÐ¾Ð½Ð¾Ð¼Ð¸Ñ Ñ€ÐµÑÑƒÑ€ÑÐ¾Ð²)
# - ÐŸÐ¾Ð´Ñ…Ð¾Ð´Ð¸Ñ‚ Ð´Ð»Ñ feature Ð²ÐµÑ‚Ð¾Ðº Ð¸ development Ð¿Ð¾Ñ‚Ð¾ÐºÐ°
#
# Ð¢Ñ€Ð¸Ð³Ð³ÐµÑ€Ñ‹: push Ð² development Ð¸ feature Ð²ÐµÑ‚ÐºÐ¸
name: Development CI

on:
  push:
    branches:
      - develop
      - 'dev/**'
      - 'feature/**'
      - 'feat/**'
      - 'bugfix/**'
      - 'hotfix/**'

jobs:
  # ðŸ“‹ ÐÐ½Ð°Ð»Ð¸Ð· ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð° development Ð²ÐµÑ‚ÐºÐ¸
  dev-branch-context:
    name: ðŸ“‹ Development Branch Context
    runs-on: ubuntu-latest
    outputs:
      branch-name: ${{ github.ref_name }}
      branch-type: ${{ steps.classify.outputs.branch-type }}
      commit-sha: ${{ github.sha }}

    steps:
      - name: Classify Branch Type
        id: classify
        run: |
          BRANCH="${{ github.ref_name }}"

          if [[ "$BRANCH" == "develop" ]]; then
            echo "branch-type=main-development" >> $GITHUB_OUTPUT
            echo "ðŸ“‹ Branch type: Main Development"
          elif [[ "$BRANCH" == feature/* ]] || [[ "$BRANCH" == feat/* ]]; then
            echo "branch-type=feature" >> $GITHUB_OUTPUT
            echo "ðŸ“‹ Branch type: Feature Development"
          elif [[ "$BRANCH" == bugfix/* ]]; then
            echo "branch-type=bugfix" >> $GITHUB_OUTPUT
            echo "ðŸ“‹ Branch type: Bug Fix"
          elif [[ "$BRANCH" == hotfix/* ]]; then
            echo "branch-type=hotfix" >> $GITHUB_OUTPUT
            echo "ðŸ“‹ Branch type: Hotfix"
          else
            echo "branch-type=general-development" >> $GITHUB_OUTPUT
            echo "ðŸ“‹ Branch type: General Development"
          fi

      - name: Display Development Context
        run: |
          echo "ðŸ› ï¸ Development CI Pipeline Started"
          echo "ðŸŒ¿ Branch: ${{ github.ref_name }}"
          echo "ðŸ·ï¸ Type: ${{ steps.classify.outputs.branch-type }}"
          echo "ðŸ“ Commit: ${{ github.sha }}"
          echo "ðŸ‘¤ Author: ${{ github.event.head_commit.author.name }}"

  # âš¡ Ð‘Ñ‹ÑÑ‚Ñ€Ð°Ñ ÐºÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ñ Ð´Ð»Ñ Ñ€Ð°Ð½Ð½ÐµÐ³Ð¾ Ð¾Ð±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼
  rapid-build-validation:
    name: âš¡ Rapid Build Validation
    runs-on: ubuntu-latest
    environment: dev
    needs: dev-branch-context

    steps:
      - name: Checkout Development Branch
        uses: actions/checkout@v4

      - name: Setup JDK 24
        uses: actions/setup-java@v4
        with:
          java-version: '24'
          distribution: 'temurin'
          cache: maven

      - name: Fast Compilation Check
        run: |
          echo "::group::âš¡ Fast build validation for development"
          echo "Performing quick compilation to catch basic issues early..."
          echo "Branch: ${{ needs.dev-branch-context.outputs.branch-name }}"
          echo "Type: ${{ needs.dev-branch-context.outputs.branch-type }}"

          # Ð‘Ñ‹ÑÑ‚Ñ€Ð°Ñ ÐºÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ñ Ð±ÐµÐ· Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¾Ðº
          mvn clean compile -B -q \
            -Dskip.checkstyle=true \
            -Dskip.tests=true

          echo "âœ… Fast build validation completed successfully"
          echo "::endgroup::"

      # Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ develop Ð²ÐµÑ‚ÐºÐ¸
      - name: Enhanced Validation for Main Development
        if: needs.dev-branch-context.outputs.branch-type == 'main-development'
        run: |
          echo "::group::ðŸ” Enhanced validation for develop branch"
          echo "Running additional checks for main development branch..."

          # Ð”Ð»Ñ develop Ð²ÐµÑ‚ÐºÐ¸ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð±Ð°Ð·Ð¾Ð²ÑƒÑŽ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸ÑŽ ÑÑ‚Ð¸Ð»Ñ
          mvn validate -B -q

          echo "âœ… Enhanced validation completed"
          echo "::endgroup::"

  # ðŸ Ð˜Ñ‚Ð¾Ð³Ð¾Ð²Ñ‹Ð¹ ÑÑ‚Ð°Ñ‚ÑƒÑ development CI
  development-ci-summary:
    name: ðŸ Development CI Summary
    runs-on: ubuntu-latest
    needs: [dev-branch-context, rapid-build-validation]
    if: always()

    steps:
      - name: Generate Development CI Summary
        run: |
          echo "::group::ðŸ Development CI Summary"

          BRANCH="${{ needs.dev-branch-context.outputs.branch-name }}"
          BRANCH_TYPE="${{ needs.dev-branch-context.outputs.branch-type }}"
          BUILD_STATUS="${{ needs.rapid-build-validation.result }}"

          echo "ðŸ“Š Development CI Results:"
          echo "  ðŸŒ¿ Branch: $BRANCH"
          echo "  ðŸ·ï¸ Type: $BRANCH_TYPE"
          echo "  âš¡ Build validation: $BUILD_STATUS"

          if [[ "$BUILD_STATUS" == "success" ]]; then
            echo ""
            echo "âœ… Development CI completed successfully!"
            echo "ðŸš€ $BRANCH is ready for further development"

            case "$BRANCH_TYPE" in
              "main-development")
                echo "ðŸ’¡ Tip: Ready to create feature branches from develop"
                ;;
              "feature")
                echo "ðŸ’¡ Tip: Ready to create PR to develop when feature is complete"
                ;;
              "bugfix"|"hotfix")
                echo "ðŸ’¡ Tip: Ready to create PR to main/develop when fix is complete"
                ;;
            esac
          else
            echo ""
            echo "âŒ Development CI failed"
            echo "ðŸ”§ Please fix compilation issues in $BRANCH"
            exit 1
          fi

          echo "::endgroup::"

      - name: Create Development Summary
        if: always()
        run: |
          cat >> $GITHUB_STEP_SUMMARY << 'EOF'
          ## ðŸ› ï¸ Development CI Results

          ### ðŸŒ¿ Branch Information
          - **Branch**: `${{ needs.dev-branch-context.outputs.branch-name }}`
          - **Type**: ${{ needs.dev-branch-context.outputs.branch-type }}
          - **Commit**: `${{ needs.dev-branch-context.outputs.commit-sha }}`

          ### âš¡ Validation Results
          | Check | Status | Description |
          |-------|---------|-------------|
          | âš¡ Rapid Build | ${{ needs.rapid-build-validation.result == 'success' && 'âœ… Passed' || 'âŒ Failed' }} | Fast compilation validation |

          ### ðŸŽ¯ Branch Workflow
          ${{ needs.dev-branch-context.outputs.branch-type == 'main-development' && '**Develop Branch** - Main development line, ready for feature branching' || needs.dev-branch-context.outputs.branch-type == 'feature' && '**Feature Branch** - Ready to create PR to develop when complete' || needs.dev-branch-context.outputs.branch-type == 'bugfix' && '**Bugfix Branch** - Ready to create PR when fix is complete' || needs.dev-branch-context.outputs.branch-type == 'hotfix' && '**Hotfix Branch** - Ready to create PR for urgent fix' || '**Development Branch** - Continue development as needed' }}

          ### ðŸ’¡ Next Steps
          ${{ needs.rapid-build-validation.result == 'success' && 'âœ… **Continue Development** - Build validation passed, development can continue.' || 'âŒ **Fix Required** - Compilation issues detected, please resolve before continuing.' }}
          EOF
